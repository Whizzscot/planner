<!DOCTYPE html>
<html>
    <head>
        <title>Planner</title>
        <meta charset="utf-8">
        <style>
            html,body{
                margin:0px;
                padding:0px;
                display:flex;
                flex-direction:column;
                width:100vw;
                height:100vh;
                background-color: white;
            }

            #indicator{
                border:1px solid rgb(100,100,100);
                border-radius:100%;
                background-color:rgb(100,100,100);
                transition:background-color 0.5s;
                width:20px;
                height:20px;
                position:fixed;
                top:5px;
                right:5px;
            }
        </style>
    </head>
    <body>
        <div id="indicator"></div>
        <form><label for="send pings">Send Pings:</label><input type="checkbox" id="send pings" name="send pings"></form>
    </body>
    <script>
        const API_DIRECTORY = "https://elliotmcleish.wixsite.com/planner";

        async function API(name, args = {}, method = "get"){
            try{
                let url = `${API_DIRECTORY}/_functions/${name}`;
                url+="?";
                for(let argname in args){
                    url+=`${encodeURIComponent(argname)}=${encodeURIComponent(JSON.stringify(args[argname]))}&`;
                }
                url = url.slice(0,-1);
                let response = await fetch(url, {method});
                let isJSON = response.headers.get("Content-Type") == "application/json";
                console.log(isJSON);
                return {
                    err:null,
                    response,
                    body: await response[isJSON ? "json" : "text"](),
                };
            } catch(err) {
                if(err.message == "Failed to fetch" && name!= "ping")
                    console.warn(`API function "${name}()" does not exist.`);
                return {err};
            }
        }

        function setIndicatorColour(col){
            document.getElementById("indicator").style.backgroundColor = col;
        }

        async function ping(){
            if(!document.getElementById("send pings").checked) return;
            let result = await API("ping");
            setIndicatorColour(result.err ? "rgb(230,0,0)" : "rgb(0,200,0)");
        }

        ping();
        window.setInterval(ping,1000);
    </script>
</html>
